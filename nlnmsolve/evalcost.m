function [cost,g] = evalcost(z0g,dt,z0,stateeq)% [cost] = evalcost(z0g,dt,stateeq) evaluates a cost function representing% how far the initial state vector is from being on a mode.%       %   INPUTS:  z0g     : vector of initial state values.  See rk4_1.%            dt      : time step for spline of result%            stateeq : name of state equation function%            % Version 1.1% J. C. Slater 1/94% Copyright (c) 1994 by J. C. Slater% All Rights Reserved.% Modified 3/8/94flag=1;%Plot or not?  1 yes, other no. Plotting takes about 1.5 sec.%tic;%z0g;%dt;%stateeq;%disp('Evalcosts')% These two lines parse the vector into the time step and the state vector.tf=z0g(1);z0g=z0g(2:length(z0g));z0(4:2:length(z0))=z0g;z0g=z0;%tvec=0:dt:tf;%disp('Forwards Integrating')%[tp,zp]=ode45(stateeq,0,tf,z0g);%disp('Backwards Integration')%[tn,zn]=ode45(stateeq,0,-tf,z0g);%disp('Integrating')z0f=z0g;z0b=z0g;z0b(2:2:length(z0g))=-z0g(2:2:length(z0g));[tp,z]=ode45(stateeq,0,tf,[z0f;z0b],1e-10);z=z';tp=tp';zf=z(1:length(z0g),:);zb=z(length(z0g)+1:2*length(z0g),:);zb(2:2:length(z0g),:)=-zb(2:2:length(z0g),:);zbflip=zb(:,length(zb):-1:1);tbflip=-tp(length(tp):-1:1);cost1=norm(zf-zbflip);cost2=norm(zf(:,1)-zf(:,length(zf)))*5;cost=cost1*.5+cost2;if flag ==1	clg	subplot(2,2,1)	plot([tbflip tp],[zbflip(1,:) zf(1,:)],'-',...		[tbflip tp],[zbflip(2,:) zf(2,:)],'--',...		[tbflip tp],[zbflip(3,:) zf(3,:)],':',...		[tbflip tp],[zbflip(4,:) zf(4,:)],'-.')	title('Integration Forwards and Backwards')	subplot(2,2,2)	axis([0,1,0,1])	constStr=num2str(cost1);	text(.1,1,['Cost1 = ' constStr])	constStr=num2str(cost2);	text(.1,.9,['Cost2 = ' constStr])	statestr=['__  ';'--- ';'....';'-.- '];	for i=1:length(z0g)		stateval=num2str(z0g(i));		text(.1,.9-.1*i,['State ' num2str(i) ' (' statestr(i,:) ') = ' stateval])	end	subplot(2,2,3)	plot(tp,zf(1,:),'-',tp,zbflip(1,:),'-',...		tp,zf(2,:),'--',tp,zbflip(2,:),'--',...		tp,zf(3,:),':',tp,zbflip(3,:),':',...		tp,zf(4,:),'-.',tp,zbflip(4,:),'-.')	title('Comparison of Cycles')	subplot(2,2,4)	error1=zf-zbflip;	plot(tp,error1(1,:),'-',...		tp,error1(2,:),'--',...		tp,error1(3,:),':',...		tp,error1(4,:),'-.')	title('Subtraction of States')	pause(.000000001)endg=0;%toc;%pause